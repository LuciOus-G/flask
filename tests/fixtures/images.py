from base64 import b64encode
import random

from bs4 import BeautifulSoup
import requests


class ImageDownloader(object):

    def __init__(self, base_url='https://openclipart.org', query_builder=None):
        self.base_url = base_url
        self.query_builder = query_builder or (
            lambda: "{base}/search/?query={query}".format(
                base=self.base_url,
                query=random.choice(
                    ['food', 'people', 'flags', 'technology']))
        )

    def get_page_contents(self, build_url, **kwargs):
        resp = requests.get(build_url(**kwargs))
        return BeautifulSoup(resp.content)

    def extract_image_absolute_urls(self, html):
        return ["{base_url}{path}".format(base_url=self.base_url,
                                          path=img['src'])
                for img in html('img')]

    def get_images_as_b64(self, count=5):
        html = self.get_page_contents(self.query_builder)
        img_urls = self.extract_image_absolute_urls(html)

        results = []
        while len(results) < count and img_urls:
            url = img_urls.pop()
            results.append(b64encode(requests.get(url).content))

        return results

# Set of 5 pre-base64 encoded images
base_64_encoded_images = [
    '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'
]
